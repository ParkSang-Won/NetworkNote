# 시스템 서비스 관리

## 1. 자동으로 기동되는 시스템 프로세스

pstree 를 확인하면 systemd가 가장 왼쪽에서 나타나는 것을 알 수있다.


win pc를 실행 할 때
PC 전원 -> 물리적 점검 -> boot loader(커널을 찾아 메모리로 로딩, 기동해준다) 실행 -> 윈도우 스타트 코드 동작

linux pc를 실행 할 때
boot loader(grub2)(커널을 찾아 메모리로 로딩, 기동해준다) -> 커널 메뉴를 보여줌
init,crm,sshd  -> service,chkconfig(부팅 시 자동으로 로드)를 통해 시작

systemd(deamon process) 
- 새로운 init + xinetd 시스템
- cgroup(자원을 분배) 이용을 통한 프로세스 추적

systemctl
- systemd의 object(unit) 관리 명령
- unit 종류
	service : 데몬 프로세스 관리
		데몬(deamon)프로세스 : 터미널과 무관, 무한루프, systemctl로 제어 
	socket : xinetd 방식(필요할 때 실행)(거의 쓰일 일이 없다)
	path : 특정 파일시스템이 변경이 될 때 활성화될 서비스 관리(spool 디렉토리)
- systemctl status name.type
- stop, start, restart, reload(중단없이 최신화), list-depencies UNIT, mask(사용불가)/unmask, enable/disable
- systemctl start 서비스 -> systemctl enable 서비스

mask 사용 예시
서버 시간 동기화
ntpd - 서버 시간 동기화 -> mask를 통해 cronyd 만 사용


## 실습1
>systemctl list-units
>systemctl status crond.service
>systemctl stop crond.service
>systemctl status crond.service (inactive 확인)
>systemctl disable crond.service (명령줄 확인)
>Removed /etc/systemd/system/multi-user.target.wants/crond.service.
>cd  /etc/systemd/system/multi-user.target.wants/
>ls cron* (크론 파일 없는것 확인)
>systemctl enable crond.service
>ls cron*(크론 파일 생긴것 확인)

cd prometheus

prometheus_systemd 파일
	[Unit]
	Description=Prometheus Server
	Documentation=https://prometheus.io/docs/introduction/overview/
	After=network-online.target
	[Service]
	User=prometheus
	Restart=on-failure
	ExecStart=/bin/sh -c '/home/prometheus/prometheus/prometheus \
	--config.file=/home/prometheus/prometheus/prometheus.yml \
	--storage.tsdb.path=/home/prometheus/prometheus/tsdb-data \
	--web.enable-lifecycle'
	StartLimitBurst=0
	[Install]
	WantedBy=multi-user.target
